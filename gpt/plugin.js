(()=>{var z=Object.create;var g=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var A=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),q=(t,n)=>{for(var e in n)g(t,e,{get:n[e],enumerable:!0})},y=(t,n,e,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of k(n))!B.call(t,s)&&s!==e&&g(t,s,{get:()=>n[s],enumerable:!(l=N(n,s))||l.enumerable});return t};var v=(t,n,e)=>(e=t!=null?z(T(t)):{},y(n||!t||!t.__esModule?g(e,"default",{value:t,enumerable:!0}):e,t)),L=t=>y(g({},"__esModule",{value:!0}),t);var u=A((oe,b)=>{b.exports=shelter.solidWeb});var te={};q(te,{onLoad:()=>Z,onUnload:()=>ee});var f=v(u(),1),x=v(u(),1),M=v(u(),1),a=v(u(),1),r=v(u(),1),E=(0,f.template)('<div class="pr-2"><div class="mb-2 flex"><div class="label-spacing"></div></div><div class="label-spacing"></div></div>',8),I=(0,f.template)("<div></div>",2),K=(0,f.template)('<div id="generate-button"><button><div><svg viewBox="0 0 315.8 320" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"><path d="m294.9 131c7.3-21.8 4.8-45.7-6.9-65.5-17.5-30.4-52.6-46-86.8-38.7-15.2-17.2-37.1-26.9-60.1-26.8-35 0-66.1 22.5-76.9 55.8-22.5 4.6-41.9 18.7-53.3 38.7-17.6 30.3-13.6 68.5 9.9 94.5-7.3 21.8-4.8 45.7 6.9 65.5 17.5 30.4 52.6 46 86.8 38.7 15.2 17.2 37.2 27 60.1 26.8 35.1 0 66.2-22.5 76.9-55.9 22.5-4.6 41.9-18.7 53.3-38.7 17.6-30.3 13.5-68.5-9.9-94.5zm-120.3 168.1c-14 0-27.6-4.9-38.4-13.9.5-.3 1.3-.7 1.9-1.1l63.7-36.8c3.3-1.9 5.3-5.3 5.2-9.1v-89.8l26.9 15.6c.3.1.5.4.5.7v74.4c0 33.1-26.8 59.9-59.9 60zm-128.8-55c-7-12.1-9.6-26.4-7.2-40.2.5.3 1.3.8 1.9 1.1l63.7 36.8c3.2 1.9 7.2 1.9 10.5 0l77.8-44.9v31.1c0 .3-.1.6-.4.8l-64.4 37.2c-28.7 16.5-65.3 6.7-81.9-21.9zm-16.8-139.1c7-12.2 18-21.5 31.2-26.3v2.2 73.6c0 3.7 2 7.2 5.2 9.1l77.8 44.9-26.9 15.6c-.3.2-.6.2-.9 0l-64.4-37.2c-28.6-16.6-38.5-53.2-22-81.9zm221.3 51.5-77.8-44.9 26.9-15.5c.3-.2.6-.2.9 0l64.4 37.2c28.7 16.6 38.5 53.3 21.9 81.9-7 12.1-18 21.4-31.2 26.3v-75.8c0-3.7-2-7.2-5.2-9.1zm26.8-40.3c-.5-.3-1.3-.8-1.9-1.1l-63.7-36.8c-3.2-1.9-7.2-1.9-10.5 0l-77.8 44.9v-31.1c0-.3.1-.6.4-.8l64.4-37.2c28.7-16.5 65.4-6.7 81.9 22 7 12.1 9.5 26.3 7.1 40.1zm-168.5 55.4-26.9-15.6c-.3-.1-.5-.4-.5-.7v-74.4c0-33.1 26.9-60 60-59.9 14 0 27.6 4.9 38.3 13.9-.5.3-1.3.7-1.9 1.1l-63.7 36.8c-3.3 1.8-5.3 5.3-5.2 9.1v89.8s0 0 0 0zm14.6-31.5 34.7-20 34.7 20v40l-34.6 20-34.7-20v-40z"></path></svg></div></button></div>',10),{observeDom:P,ui:{injectCss:O,Button:C,openModal:R,ModalRoot:j,ModalHeader:G,ModalBody:F,ModalFooter:H,ModalSizes:U,Text:_,TextBox:W,ReactiveRoot:D,TextArea:J,ButtonLooks:V},plugin:{store:h},util:{getFiber:Q}}=shelter,S=null,w=null,X=()=>[...document.querySelectorAll('div[class^="message-"]')].map(e=>({username:e.querySelector("h3 > span > span")?.textContent,message:e.querySelector("div > div > div").textContent})).reduce((e,l)=>(l.username?e.push(l):e[e.length-1].message+=`
${l.message}`,e),[]),Y=t=>{let n=document.querySelector('[class*="slateContainer-"]');Q(n).child.pendingProps.editor.insertText(t)};function Z(){O(`
  .label-spacing {
    margin-bottom: .125rem;
  }
  .mb-2 {
    margin-bottom: .5rem;
  }
  
  .pr-2 {
    padding-right: .5rem;
  }`);let t=null,n=async()=>{let e=h.openaiKey?.startsWith("sk-"),l=h.model||"gpt-3.5-turbo",s=l,d="";t=R($=>(0,r.createComponent)(j,{get size(){return U.SMALL},get children(){return[(0,r.createComponent)(G,{close:()=>t(),children:"Generate Response"}),(0,r.createComponent)(F,{get children(){let o=E.cloneNode(!0),c=o.firstChild,m=c.firstChild,i=c.nextSibling;return(0,a.insert)(m,(0,r.createComponent)(_,{children:"Model"})),(0,a.insert)(c,(0,r.createComponent)(W,{placeholder:"gpt-3.5-turbo",value:l,onInput:p=>{s=p}}),null),(0,a.insert)(i,(0,r.createComponent)(_,{children:"Prompt"})),(0,a.insert)(o,(0,r.createComponent)(J,{width:"100%",value:"",placeholder:"Prompt",onInput:p=>{d=p}}),null),o}}),(0,r.createComponent)(H,{get children(){let o=I.cloneNode(!0);return o.style.setProperty("display","flex"),(0,a.insert)(o,(0,r.createComponent)(C,{grow:!0,onClick:async()=>{t();let c=document.querySelector("[class^=nameTag] > div").textContent;h.model=s;let m=[...X().slice(-7).map(i=>({role:"user",content:`${i.username}: ${i.message}`})),{role:"system",content:`generate a response as "${c}" according to the prompt: "${d}"`}];fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h.openaiKey}`},body:JSON.stringify({model:s,messages:m})}).then(i=>i.json()).then(i=>{let p=i.choices[0].message.content;Y(p.replace(/^(?=.{0,49}:)([\w\s\-]+?[^ ]):/,"").trim())})},children:"Generate"}),null),(0,a.insert)(o,(0,r.createComponent)(C,{get look(){return V.LINK},grow:!0,onClick:()=>{let c=window.prompt("Enter your OpenAI key");h.openaiKey=c,e=!0},get children(){return[e?"Change":"Set"," OpenAI key"]}}),null),o}})]}}))};w=P('[class^="channelTextArea"] [class^="buttons"]',e=>{if(document.querySelector("#generate-button"))return;let l=e.lastChild.previousSibling;S=e.insertBefore((0,r.createComponent)(D,{get children(){let s=K.cloneNode(!0),d=s.firstChild,$=d.firstChild;return d.$$click=n,(0,M.effect)(o=>{let c=l.className,m=l.firstChild.className,i=l.firstChild.firstChild.className;return c!==o._v$&&(s.className=o._v$=c),m!==o._v$2&&(d.className=o._v$2=m),i!==o._v$3&&($.className=o._v$3=i),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),s}}),e.firstChild)})}function ee(){w(),S?.remove()}(0,x.delegateEvents)(["click"]);return L(te);})();
